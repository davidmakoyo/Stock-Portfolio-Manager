<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Stock Portfolio Optimizer</title>
  <link rel="icon" href="1f4c8.png" type="image/x-icon">
  <link href="style.css" rel="stylesheet" type= "text/css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
  
<nav class="border-gray-200 bg-gray-50 dark:bg-gray-800 dark:border-gray-700">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
          <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">ðŸ“ˆSPO</span>
      </a>
      <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
          </svg>
      </button>
      <div class="hidden w-full md:block md:w-auto" id="navbar-solid-bg">
        <ul class="flex flex-col font-medium mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700">
          <li>
            <a href="#" class="block py-2 px-3 md:p-0 text-white bg-blue-700 rounded md:bg-transparent md:text-green-700 md:dark:text-blue-500 dark:bg-blue-600 md:dark:bg-transparent" aria-current="page">Home</a>
          </li>
          <li>
            <a href="#" class="block py-2 px-3 md:p-0 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-green-700 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Investment Strategies</a>
            <div data-popover id="popover-default" role="tooltip" class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
                <div class="px-3 py-2 bg-gray-100 border-b border-gray-200 rounded-t-lg dark:border-gray-600 dark:bg-gray-700">
                    <h3 class="font-semibold text-gray-900 dark:text-white">Data Source</h3>
                </div>
                <div class="px-3 py-2">
                    <a style="color: rgb(0, 0, 255);" href="https://site.financialmodelingprep.com/developer/docs" target="_blank"><u>Financial Modeling Prep</u></a>
                </div>
                <div data-popper-arrow></div>
            </div>
        </li>
          <li>
            <a data-popover-target="popover-default" href="#" class="block py-2 px-3 md:p-0 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-green-700 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">About</a>
          </li>
          <li>
            <!-- <a href="#" class="block py-2 px-3 md:p-0 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Contact</a> -->
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <p class="SPM">Stock Portfolio Optimizer</p> 
  <div class="form-container">
    <div class="form-row">
        <label for="stock1">Stock</label>
        <input type="text" id="stock1" name="stock1" placeholder="Enter ticker">
        <label for="shares1">Shares</label>
        <input type="number" id="shares1" name="shares1" placeholder="Enter # of shares">
    </div>
    <div id="additional-stocks"></div>
    <div class="add-stock" onclick="addNewStockRow()">+ Add new stock</div>
    <div class="button-container">
        <button id="visualize" type="button" class="text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 dark:focus:ring-lime-800 shadow-lg shadow-lime-500/50 dark:shadow-lg dark:shadow-lime-800/80 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">Visualize</button>
    </div>
    <div id="pie-chart-container">
        <div id="pie-chart"></div>
    </div>
    <p id="select-tolerance-text">Select Risk Tolerance</p>
    <div class="inline-flex rounded-md shadow-sm" role="group" id="risk-buttons">
        <button id="low-risk" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-s-lg hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
        Low
        </button>
        <button id="medium-risk" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
        Medium
        </button>
        <button id="high-risk" type="button" class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-e-lg hover:bg-gray-100 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white">
        High
        </button>
    </div>
  
    
  </div>


<script>
    let stockCount = 1;

    function addNewStockRow() {
        stockCount++;
        const newStockRow = document.createElement('div');
        newStockRow.className = 'form-row';
        newStockRow.innerHTML = `
            <label for="stock${stockCount}">Stock</label>
            <input type="text" id="stock${stockCount}" name="stock${stockCount}" placeholder="Enter ticker">
            <label for="shares${stockCount}">Shares</label>
            <input type="number" id="shares${stockCount}" name="shares${stockCount}" placeholder="Enter # of shares">
        `;
        document.getElementById('additional-stocks').appendChild(newStockRow);
    }

    async function fetchStockPrice(ticker) {
        const API_KEY = '0S4wTnYC9S9EUQiPQhcutGEvcGNqq1LL';
        const url = `https://financialmodelingprep.com/api/v3/quote/${ticker}?apikey=${API_KEY}`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            if (data && data.length > 0) {
                return data[0].price;
            } else {
                console.error('Error fetching stock price');
                return null;
                // if error fetching stock price throw up an error bubble or something blank is not a valid tticker
            }
        } catch (error) {
            console.error('Error fetching stock price', error);
            return null;
        }
    }

    const width = 400;
    const height = 400;
    const radius = Math.min(width, height) / 2;

    const svg = d3.select('#pie-chart')
    .append('svg')
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .attr('transform', `translate(${width / 2}, ${height / 2})`);

const color = d3.scaleOrdinal(d3.schemeCategory10);

// Shape helper to build arcs
const arcGenerator = d3.arc()
    .innerRadius(0)
    .outerRadius(radius);

// Pie function to convert data into pie slices
const pie = d3.pie()
    .value(d => d.value);

// Function to update the pie chart with data
function updatePieChart(data) {
    const arcs = pie(data);

    // Build the pie chart: each part of the pie is a path that we build using the arc function
    const path = svg.selectAll("path")
        .data(arcs);

    path.enter()
        .append("path")
        .merge(path)
        .attr("fill", d => color(d.data.label))
        .attr("stroke", "white")
        .style("stroke-width", "0px")
        .style("opacity", 0.7)
        .each(function(d) { this._current = d; }) // store the initial angles
        .transition()
        .duration(750)
        .attrTween("d", function(d) {
            const interpolate = d3.interpolate(this._current, d);
            this._current = interpolate(0);
            return t => arcGenerator(interpolate(t));
        });

    path.exit().remove();

    // Add the annotation: use the centroid method to get the best coordinates
    const text = svg.selectAll("text")
        .data(arcs);

    text.enter()
        .append("text")
        .merge(text)
        .transition()
        .duration(750)
        .attr("transform", d => `translate(${arcGenerator.centroid(d)})`)
        .attr("dy", "0.35em")
        .style("text-anchor", "middle")
        .style("font-size", "17px")
        .text(d => d.data.label);

    text.exit().remove();
}

    updatePieChart([
        { label: 'AAPL', value: 100 },
        { label: 'GOOGL', value: 200 },
        { label: 'AMZN', value: 300 },
    ]);
    

    document.getElementById('visualize').addEventListener('click', async () => {
        // if visualize is empty throw an error thru a toast or something "Add at least one stock to visualize"
        const stocks = [];
        for (let i = 1; i <= stockCount; i++) {
            const stock = document.getElementById(`stock${i}`).value;
            const shares = document.getElementById(`shares${i}`).value;
            if (stock && shares) {
                stocks.push({ stock, shares });
            }
        }
        console.log(stocks);

        const positionValues = {};
        const pricePromises = stocks.map(({ stock, shares }) => {
        return fetchStockPrice(stock).then(price => {
            if (price) {
                positionValues[stock] = price * shares;
            }
        });
    });

    await Promise.all(pricePromises);

    console.log(positionValues);

    const data = Object.entries(positionValues).map(([label, value]) => ({ label, value }));
    console.log(data);

    updatePieChart(data);
    });

    let riskTolerance = '';

    document.getElementById('low-risk').addEventListener('click', function() {
        riskTolerance = 'Low';
        updateRiskTolerance(riskTolerance);
    });

    document.getElementById('medium-risk').addEventListener('click', function() {
        riskTolerance = 'Medium';
        updateRiskTolerance(riskTolerance);
    });

    document.getElementById('high-risk').addEventListener('click', function() {
        riskTolerance = 'High';
        updateRiskTolerance(riskTolerance);
    });

    function updateRiskTolerance(risk) {
        console.log('Risk Tolerance set to:', risk);
    }
</script>
  <script src="script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
</body>

</html>