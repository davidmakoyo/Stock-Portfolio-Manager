<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Stock Portfolio Optimizer</title>
  <link rel="icon" href="1f4c8.png" type="image/x-icon">
  <link href="style.css" rel="stylesheet" type= "text/css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
  
<nav class="border-gray-200 bg-gray-50 dark:bg-gray-800 dark:border-gray-700">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
          <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">ðŸ“ˆSPO</span>
      </a>
      <button data-collapse-toggle="navbar-solid-bg" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-solid-bg" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
          </svg>
      </button>
      <div class="hidden w-full md:block md:w-auto" id="navbar-solid-bg">
        <ul class="flex flex-col font-medium mt-4 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent dark:border-gray-700">
          <li>
            <a href="#" class="block py-2 px-3 md:p-0 text-white bg-blue-700 rounded md:bg-transparent md:text-green-700 md:dark:text-blue-500 dark:bg-blue-600 md:dark:bg-transparent" aria-current="page">Home</a>
          </li>
          <li>
            <a href="#" class="block py-2 px-3 md:p-0 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-green-700 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Investment Strategies</a>
          </li>
          <li>
            <a href="#" class="block py-2 px-3 md:p-0 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-green-700 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">About</a>
          </li>
          <li>
            <!-- <a href="#" class="block py-2 px-3 md:p-0 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Contact</a> -->
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <p class="SPM">Stock Portfolio Optimizer</p> 
  <div class="form-container">
    <div class="form-row">
        <label for="stock1">Stock</label>
        <input type="text" id="stock1" name="stock1" placeholder="Enter ticker">
        <label for="shares1">Shares</label>
        <input type="number" id="shares1" name="shares1" placeholder="Enter # of shares">
    </div>
    <div id="additional-stocks"></div>
    <div class="add-stock" onclick="addNewStockRow()">+ Add new stock</div>
    <div class="button-container">
        <button id="visualize" type="button" class="text-gray-900 bg-gradient-to-r from-lime-200 via-lime-400 to-lime-500 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-lime-300 dark:focus:ring-lime-800 shadow-lg shadow-lime-500/50 dark:shadow-lg dark:shadow-lime-800/80 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">Visualize</button>

    </div>
  </div>


<script>
    let stockCount = 1;

    function addNewStockRow() {
        stockCount++;
        const newStockRow = document.createElement('div');
        newStockRow.className = 'form-row';
        newStockRow.innerHTML = `
            <label for="stock${stockCount}">Stock</label>
            <input type="text" id="stock${stockCount}" name="stock${stockCount}" placeholder="Enter ticker">
            <label for="shares${stockCount}">Shares</label>
            <input type="number" id="shares${stockCount}" name="shares${stockCount}" placeholder="Enter # of shares">
        `;
        document.getElementById('additional-stocks').appendChild(newStockRow);
    }

    async function fetchStockPrice(ticker) {
        const API_KEY = '0S4wTnYC9S9EUQiPQhcutGEvcGNqq1LL';
        const url = `https://financialmodelingprep.com/api/v3/quote/${ticker}?apikey=${API_KEY}`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            if (data && data.length > 0) {
                return data[0].price;
            } else {
                console.error('Error fetching stock price');
                return null;
                // if error fetching stock price throw up an error bubble or something
            }
        } catch (error) {
            console.error('Error fetching stock price', error);
            return null;
        }
    }

    const width = 400;
    const height = 400;
    const radius = Math.min(width, height) / 2;

    const svg = d3.select('#pie-chart')
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${width / 2}, ${height / 2})`);

    document.getElementById('visualize').addEventListener('click', () => {
        const stocks = [];
        for (let i = 1; i <= stockCount; i++) {
            const stock = document.getElementById(`stock${i}`).value;
            const shares = document.getElementById(`shares${i}`).value;
            if (stock && shares) {
                stocks.push({ stock, shares });
            }
        }
        console.log(stocks);

        const positionValues = {};
        for (const { stock, shares } of stocks) {
            fetchStockPrice(stock).then(price => {
                if (price) {
                    positionValues[stock] = price * shares;
                }
            });
        }
        console.log(positionValues);
    });
</script>
  <script src="script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
</body>

</html>